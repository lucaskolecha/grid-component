!function(e){function n(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}var t={};n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=0)}([function(e,n,t){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function e(e,n,t,o){function l(l,i,r,d){var u=this,s=void 0,c=void 0;u.$onInit=function(){function p(){return u.displayClear}function m(){return u.displayInfo}function y(){var e=sessionStorage.getItem("user");return e?(e=JSON.parse(e),(e.instanceOrganizationHierarchyCode||"")+"favorite-"+r.name):"favorite-"+r.name}function f(){return!!u.disabled||(!u.value||!("object"===a(u.value)))}function g(){return!("object"===a(u.value))}function v(){u.visible="typeahead",u.onDeselect&&u.onDeselect({value:angular.copy(u.value)}),delete u.value,document.getElementById("typeahead-"+u.field+"-"+r.value).focus()}function h(){if(u.opened=!0,u.value)delete u.value,b();else{if(u.isTypeaheadOpen)return;document.getElementById("typeahead-"+u.field+"-"+r.value).focus()}}function b(){u.visible="typeahead",o(function(){u.value=angular.copy(u.inputMatchValue),h(),delete u.inputMatchValue})}function O(){return u.postMethod&&("string"==typeof s.$$rawModelValue||s.$$rawModelValue instanceof String)&&s.$$rawModelValue.length>0}function T(){if(u.inputMatch){var e=document.getElementById("match-"+u.field+"-"+r.value),n=u.inputMatch.replace(/{/g,"{{").replace(/}/g,"}}").replace(/item/g,"manyToOneCtrl.value"),a='<span style="display: none;" id="match-'+u.field+"-"+r.value+'">'+n+"</span>";angular.element(e).replaceWith(t(a)(l)),o(function(){var e=document.getElementById("match-"+u.field+"-"+r.value);u.inputMatchValue=e.innerHTML,u.visible="inputMatchValue"})}else u.visible="typeahead"}function $(e,n,t,a,o,l){delete u.opened,T(),!n.id&&u.authorizeAdd&&u.proxySave(n,o),s.$setValidity("manyToOne",!0),u.ev.onSelect&&u.ev.onSelect({value:n})}function C(){function e(e,n){e.close=function(){return n.close()}}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments[1];u.isTypeaheadOpen=!0,a.stopImmediatePropagation(),a.preventDefault(),e.$inject=["$scope","$uibModalInstance"];var o='\n              <div class="modal-header">\n                <h3 class="modal-title">'+u.modalTitle+'</h3>\n              </div>\n              <div class="modal-body">\n                '+function(){return u.modalFields.reduce(function(e,n){return e+='\n                  <div class="form-group">\n                    '+("string"==typeof t[n]||t[n]instanceof String?"<label>"+n+"</label>":" ")+"\n                    "+("string"==typeof t[n]||t[n]instanceof String?'<input type="text" class="form-control" value="'+t[n]+'" disabled />':" ")+"\n                  </div>"}," ")}()+"\n              </div>\n              ";n.open({controller:e,template:o})}function x(e,n,t){var a="";if(t){var o=new Date;o.setTime(o.getTime()+24*t*60*60*1e3),a="; expires="+o.toUTCString()}document.cookie=e+"="+(n||"")+a+"; path=/"}function w(e){for(var n=e+"=",t=document.cookie.split(";"),a=0;a<t.length;a++){for(var o=t[a];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(n))return o.substring(n.length,o.length)}return null}function V(e){document.cookie=e+"=; Max-Age=-99999999;"}var M={noValue:"É necessário um atributo value no componente gumgaManyToOne",noField:"É necessário um atributo field no componente gumgaManyToOne",noSearch:"É necessário uma função de busca no componente gumgaManyToOne"},I=["loadingText","onSelect","value","list","searchMethod","field","onNewValueAdded","onValueSelected","onValueVisualizationOpened","onValueVisualizationClosed","tabindex"],S=!1,z=w(y());z&&(u.favoriteModel=JSON.parse(z)),r.debug&&u.activeFavorite&&console.log("Cookie: ",w(y())),r.debug&&(console.log("ngModel: ",u.value),console.log("activeFavorite: ",u.activeFavorite)),!u.value&&u.favoriteModel&&u.activeFavorite&&(u.value=angular.copy(u.favoriteModel)),r.value||console.error(M.noValue),r.field||console.error(M.noField),u.ev={},u.list=u.list||[],u.ev.onNewValueAdded=r.onNewValueAdded?u.onNewValueAdded:angular.noop,u.ev.onSelect=r.onSelect?u.onSelect:angular.noop,u.ev.onValueVisualizationOpened=r.onValueVisualizationOpened?r.onValueVisualizationOpened:angular.noop,u.ev.onValueVisualizationClosed=r.onValueVisualizationClosed?r.onValueVisualizationClosed:angular.noop,u.field=r.field||"",u.modalTitle=r.modalTitle||"Visualizador de Registro",u.modalFields=r.modalFields?r.modalFields.split(","):[u.field],u.postFields=r.postFields?r.postFields.split(","):[u.field],u.displayClear=!u.hasOwnProperty("displayClear")||u.displayClear,u.displayInfo=!u.hasOwnProperty("displayInfo")||u.displayInfo,u.editable=!u.hasOwnProperty("editable")||u.editable,u.async=!u.hasOwnProperty("async")||u.async,u.displayInfoButton=m,u.modelValueIsObject=f,u.disabledDisplayInfo=g,u.displayPlusButton=O,u.displayClearButton=p,u.clearModel=v,u.openInfo=C,u.valueToAdd="",u.afterSelect=$,u.openTypehead=h,u.showTypeheadAndHideMatch=b,u.proxySearch=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return u.async?u.searchMethod({param:e}).then(function(n){if(n.filter(function(n){return n[u.field]==e}).length>0||!u.authorizeAdd)return n;if(e){var t={};return t[u.field]=u.valueToAdd,n.concat(t)}return n}):(e&&(e=e.toLowerCase()),u.list.filter(function(n){return-1!=n[u.field].toLowerCase().indexOf(e)}))},u.proxySave=function(e,t){function a(e,n,t){var a=this;a.object=t,a.cancel=function(e){return n.dismiss("cancel")},a.save=function(e){return n.close(e)}}if(t){u.isTypeaheadOpen=!0;var o={value:function(){return e}};a.$inject=["$scope","$uibModalInstance","value"];var l='\n                <div class="modal-header">\n                  <h3 class="modal-title">'+u.modalTitle+'</h3>\n                </div>\n                <div class="modal-body">\n                  <form name="formNew">\n                    '+function(){return u.postFields.reduce(function(e,n){var t=-1!=n.indexOf(":")?n.trim().substring(0,n.indexOf(":")):n.trim(),a=-1!=n.indexOf(":")?n.trim().substring(n.indexOf(":")+1,n.length):"false";return e+='\n                  <div class="form-group">\n                    <label>'+t+'</label>\n                    <input type="text" class="form-control" '+("required"==a?a:"")+' ng-model="ctrl.object.'+t+'" />\n                  </div>'}," ")}()+'\n                  </form>\n                </div>\n                <div class="modal-footer">\n                  <button type="button" class="btn btn-default" ng-click="ctrl.cancel(ctrl.object)">Retornar</button>\n                  <button type="button" class="btn btn-primary" ng-disabled="!formNew.$valid" ng-click="ctrl.save(ctrl.object)">Salvar</button>\n                </div>';n.open({controller:a,template:l,controllerAs:"ctrl",resolve:o}).result.then(function(e){u.postMethod({value:e}).then(function(e){u.value=e.data.data,s.$viewValue=e.data.data})},function(e){delete u.value})}},u.isTypeaheadOpen=!0,d(l,function(e){angular.forEach(e,function(e){var n=angular.element(e)[0];n.nodeName&&"MATCH"===n.nodeName&&(S=!0,u.match=n.innerHTML)})}),u.keyUp=function(e){""==e.target.value&&40!=e.keyCode&&38!=e.keyCode&&(angular.element(e.target).blur(),o(function(){return angular.element(e.target).focus()},500))},u.favorite=function(e,n){if(angular.equals(n,u.favoriteModel))return V(y()),void delete u.favoriteModel;x(y(),JSON.stringify(n),999999),u.favoriteModel=n},u.isFavorite=function(e){return angular.equals(e,u.favoriteModel)},u.inputBlur=function(e){delete u.opened,delete u.noResults,u.value||(s.$viewValue="",s.$render())},u.inputClick=function(){u.typeaheadLoading||u.opened||u.value||(i.find("input").blur(),u.openTypehead(),i.find("input").focus())};var k='\n            <style>\n              gumga-many-to-one [uib-typeahead-popup].dropdown-menu{\n                  width: 100%;\n              }\n              gumga-many-to-one a.result {\n                display: flex;\n                height: 42px;\n                align-items: center;\n              }\n              gumga-many-to-one a.result > span.str{\n                display: flex;\n              }\n              gumga-many-to-one input{\n                color: #999 !important;\n                padding-right: 32px;\n                font-size: 1.6rem !important;\n              }\n              gumga-many-to-one button.left-button{\n                padding: 0; width: 32px; padding-top: 10px; padding-bottom: 3px;\n              }\n              gumga-many-to-one input.form-control.ng-valid-many-to-one{\n                color: #555 !important;\n              }\n              gumga-many-to-one i.favorite{\n                color: #ccc;\n              }\n              gumga-many-to-one i.favorite.full{\n                color: #d9d90d;\n              }\n              gumga-many-to-one i.favorite:hover{\n                cursor: pointer; \n              }\n              gumga-many-to-one .input-group button.btn[ng-click="manyToOneCtrl.openTypehead()"]{\n                z-index: 3;\n              }\n              gumga-many-to-one .progress {\n                max-width: 100%;\n                overflow: hidden;\n                background: #ddd;\n                left: 0;\n                width: 100%;\n                border-radius: 0;\n                height: 2px;\n                bottom: 0;\n                margin: 0;\n                padding: 0;\n                bottom: 0;\n                height: 3px;\n                z-index: 4;\n              }\n              gumga-many-to-one .indeterminate {\n                position: absolute;\n                width: 100%;\n                height: 2px;\n                transform: translateZ(0);\n              }\n              gumga-many-to-one .indeterminate:before, .indeterminate:after {\n                content: \'\';\n                position: absolute;\n                background-color: #001eff;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n              }\n              gumga-many-to-one .indeterminate:before {\n                animation: indeterminate 3s cubic-bezier(0.195, 0.36, 0.945, 1.65) infinite;\n              }\n              gumga-many-to-one .indeterminate:after {\n                animation: indeterminate 3s cubic-bezier(0.9, -0.59, 0.715, 1.045) infinite;\n              }\n              \n              @keyframes indeterminate {\n                0% {\n                  width: 0%;\n                  transform: translateX(-100%);\n                }\n                100% {\n                  width: 100%;\n                  transform: translateX(100%);\n                }\n              }\n              gumga-many-to-one input.form-control.gmd.size-55{\n                padding-right: 55px;\n              }\n              gumga-many-to-one input.form-control.gmd.size-25{\n                padding-right: 25px;\n              }\n              gumga-many-to-one.gmd .dropdown-menu > .active > a, gumga-many-to-one.gmd .dropdown-menu > .active > a:focus, gumga-many-to-one.gmd .dropdown-menu > .active > a:hover{\n                cursor: pointer;\n              }\n            </style>\n            <div style="position: relative;">\n              <div class="progress indeterminate" ng-show="manyToOneCtrl.typeaheadLoading"></div>\n              <div style="width: 100%;" ng-class="{\'input-group\': (manyToOneCtrl.displayInfoButton() && manyToOneCtrl.modelValueIsObject()) || manyToOneCtrl.displayClearButton()}">\n                  <input type="text"\n                         ng-init="manyToOneCtrl.visible = \'typeahead\'"\n                         ng-show="manyToOneCtrl.visible == \'typeahead\'"\n                         id="typeahead-'+u.field+"-"+r.value+'"\n                         class="form-control gmd inputahead"\n                         tabindex="'+u.tabSeq+'"\n                         ng-click="manyToOneCtrl.inputClick()"\n                         ng-disabled="manyToOneCtrl.disabled"\n                         ng-readonly="manyToOneCtrl.readonly"\n                         ng-model="manyToOneCtrl.value"\n                         ng-blur="manyToOneCtrl.inputBlur($event)"\n                         onfocus="this.classList.add(\'focused\')"\n                         ng-class="{\'size-25\' : manyToOneCtrl.modelValueIsObject() && manyToOneCtrl.displayClearButton(), \'size-55\' : !(manyToOneCtrl.modelValueIsObject() && manyToOneCtrl.displayClearButton())}"\n                         ng-keyup="manyToOneCtrl.keyUp($event)"\n                         onblur="this.classList.remove(\'focused\')"\n                         ng-model-options="{ debounce: '+(u.debounce||1e3)+' }"\n                         uib-typeahead="$value as $value[manyToOneCtrl.field] for $value in manyToOneCtrl.proxySearch($viewValue)"\n                         typeahead-loading="manyToOneCtrl.typeaheadLoading" '+function(){var e=function(e){return I.filter(function(n){return e==n}).length>0};return Object.keys(r.$attr).filter(function(n){return!e(n)}).reduce(function(e,n){return e+=n+'="'+r[n]+'"'},"")}()+'\n                         typeahead-template-url="manyToOneTemplate'+u.field+"-"+r.value+'.html"\n                         typeahead-is-open="manyToOneCtrl.isTypeaheadOpen"\n                         typeahead-editable="'+u.editable+'"\n                         typeahead-show-hint="true"\n                         typeahead-min-length="0"\n                         typeahead-on-select="manyToOneCtrl.afterSelect($item, $model, $label, $event, \'isNotButton\', manyToOneCtrl.match)"\n                         typeahead-no-results="manyToOneCtrl.noResults"\n                         autocomplete="off"/>\n                         <div ng-show="manyToOneCtrl.noResults" style="position: absolute; left: 0; width: 100%; top: 34px; background: #FFF; z-index: 999; padding: 15px; border-top: 1px solid #ccc; box-shadow: 0 2px 4px rgba(0,0,0,0.175);">\n                          {{'+u.messageNoResult+' || \'Nenhum resultado foi encontrado.\'}}\n                         </div>\n                  <input type="text" ng-keyup="manyToOneCtrl.showTypeheadAndHideMatch()" ng-model="manyToOneCtrl.inputMatchValue" class="form-control" ng-show="manyToOneCtrl.visible == \'inputMatchValue\'"/>\n                  <div ng-show="manyToOneCtrl.typeaheadLoading && manyToOneCtrl.loadingText" style="position: absolute; top: 40px;">\n                  <i class="glyphicon glyphicon-refresh"></i>\n                  {{manyToOneCtrl.loadingText}}\n                </div>\n                <span ng-hide="true" id="match-'+u.field+"-"+r.value+'"></span>\n                <div class="input-group-btn input-group-btn-icon" style="position: absolute; right: {{manyToOneCtrl.modelValueIsObject() && manyToOneCtrl.displayClearButton() ? \'25px;\' : manyToOneCtrl.displayInfo ? \'87px\' : \'55px\'}};" ng-show="(manyToOneCtrl.displayInfoButton() && manyToOneCtrl.modelValueIsObject()) || manyToOneCtrl.displayClearButton()">\n                  <button type="button" style="z-index: 3;" class="left-button btn btn-default gmd" ng-show="!manyToOneCtrl.modelValueIsObject() && manyToOneCtrl.displayClearButton()" ng-click="manyToOneCtrl.clearModel()">\n                    <i ng-show="manyToOneCtrl.useGumgaLayout()" class="material-icons" style="font-size: 15px;">close</i>\n                    <i ng-show="!manyToOneCtrl.useGumgaLayout()" class="glyphicon glyphicon-remove" style="font-size: 15px;"></i>\n                  </button>\n                  <button type="button" class="btn btn-default gmd"\n                          style="padding-bottom: 7px;"\n                          ng-click="manyToOneCtrl.openTypehead()">\n                    <span class="caret"></span>                    \n                  </button>\n                  <button type="button" style="z-index: 3;" class="left-button btn btn-default gmd" ng-show="!manyToOneCtrl.modelValueIsObject() && manyToOneCtrl.displayInfoButton()" ng-disabled="manyToOneCtrl.disabledDisplayInfo()" ng-click="manyToOneCtrl.openInfo(manyToOneCtrl.value, $event)">\n                    <i class="material-icons" style="font-size: 15px;">remove_red_eye</i>\n                  </button>\n                </div>\n              </div>\n            </div>',F=S?"<span>"+u.match+"</span>":'<span ng-bind-html="match.model.'+u.field+' | uibTypeaheadHighlight:query"></span>',j='\n            <a class="col-md-12 result gmd" style="white-space: normal;">\n              <span class="col-md-10 str" ng-click="manyToOneCtrl.select()">\n                '+F+'\n                <span ng-show="$parent.$parent.$parent.$parent.manyToOneCtrl.valueToAdd == match.label && $parent.$parent.$parent.$parent.manyToOneCtrl.valueToAdd.length > 0 && !match.model.id && !!$parent.$parent.$parent.$parent.manyToOneCtrl.authorizeAdd">(novo)</span><br>\n              </span>\n              <span class="col-md-2">\n                <span class="icon text-right" ng-if="'+u.displayInfo+'" ng-click="$parent.$parent.$parent.$parent.manyToOneCtrl.openInfo(match.model, $event)" ng-hide="$parent.$parent.$parent.$parent.manyToOneCtrl.valueToAdd == match.label && !match.label.id">\n                  <i class="material-icons" style="font-size: 17px; vertical-align: middle; padding-top: 5px;">remove_red_eye</i>\n                </span>\n                <span style="float: right;" ng-show="$parent.$parent.$parent.$parent.manyToOneCtrl.activeFavorite">\n                  <i ng-show="!$parent.$parent.$parent.$parent.manyToOneCtrl.isFavorite(match.model)" \n                     title="Favoritar"\n                     ng-click="$parent.$parent.$parent.$parent.manyToOneCtrl.favorite($event, match.model)" \n                     class="material-icons favorite">star_border</i>\n\n                  <i ng-show="$parent.$parent.$parent.$parent.manyToOneCtrl.isFavorite(match.model)"\n                     title="Favoritar" \n                     ng-click="$parent.$parent.$parent.$parent.manyToOneCtrl.favorite($event, match.model)" \n                     class="material-icons favorite full">star</i>\n                </span>\n              </span>\n              <div class="clearfix"></div>\n            </a>\n            ';e.put("manyToOneTemplate"+u.field+"-"+r.value+".html",j);for(var A=angular.element(k),B=A.find("input"),N=i.parent();"FORM"!=N[0].nodeName;)N=N.parent();var L=l.$parent[N.attr("name")];i.append(t(A)(l)),s=B.controller("ngModel"),c=angular.copy(s),L.$addControl(s),s.$viewChangeListeners.push(function(){}),s.$validators.manyToOne=function(e,n){return!e||!("string"==typeof e||e instanceof String)},u.useGumgaLayout=function(){try{return!!angular.module("gumga.layout")}catch(e){return!1}},f()||T(),l.$watch(function(){return s.$$rawModelValue},function(e){""==s.$$rawModelValue?(delete s.$$rawModelValue,delete u.value):u.valueToAdd=s.$$rawModelValue})}}return l.$inject=["$scope","$element","$attrs","$transclude"],{restrict:"E",replace:!0,transclude:!0,scope:{value:"=",loadingText:"@?",inputMatch:"@?",searchMethod:"&",postMethod:"&?",onSelect:"&?",activeFavorite:"=?",onDeselect:"&?",list:"=?",authorizeAdd:"=?",disabled:"=?",readonly:"=?",displayInfo:"=?",displayClear:"=?",editable:"=?",tabSeq:"=?",async:"=?",debounce:"@?"},controllerAs:"manyToOneCtrl",bindToController:!0,controller:l}}e.$inject=["$templateCache","$uibModal","$compile","$timeout"],angular.module("gumga.manytoone",["ui.bootstrap"]).directive("gumgaManyToOne",e)}()}]);